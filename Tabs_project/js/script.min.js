"use strict";window.addEventListener("DOMContentLoaded",()=>{const t=document.querySelectorAll(".tabheader__item"),e=document.querySelectorAll(".tabcontent"),s=document.querySelector(".tabheader__items");function n(){e.forEach(t=>{t.classList.add("hide"),t.classList.remove("show","fade")}),t.forEach(t=>{t.classList.remove("tabheader__item_active")})}function a(s=0){e[s].classList.add("show","fade"),e[s].classList.remove("hide"),t[s].classList.add("tabheader__item_active")}n(),a(),s.addEventListener("click",e=>{const s=e.target;s&&s.classList.contains("tabheader__item")&&t.forEach((t,e)=>{s==t&&(n(),a(e))})});let o;!function(t,e){const s=new Date(e),n=document.querySelector(t),a=("0"+s.getDate()).slice(-2),o={0:"января",1:"февраля",2:"марта",3:"апреля",4:"мая",5:"июня",6:"июля",7:"августа",8:"сентября",9:"октября",10:"ноября",11:"декабря"}[s.getMonth()],c=document.createTextNode((s-new Date>0?"Акция закончится ":"Акция закончилась ")+`${a} ${o} в 00: 00`);n.lastChild.remove(),n.append(c)}(".promotion__descr","2021-12-31"),function(t,e){const s=document.querySelector(t),n=s.querySelector("#days"),a=s.querySelector("#hours"),o=s.querySelector("#minutes"),c=s.querySelector("#seconds"),i=setInterval(r,1e3);function r(){const t=function(t){const e=Date.parse(t)-Date.parse(new Date);return e>0?{total:e,days:Math.floor(e/864e5),hours:Math.floor(e/36e5%24),minutes:Math.floor(e/1e3/60%60),seconds:Math.floor(e/1e3%60)}:{total:e,days:0,hours:0,minutes:0,seconds:0}}(e);n.innerHTML=("0"+t.days).slice(-2),a.innerHTML=("0"+t.hours).slice(-2),o.innerHTML=("0"+t.minutes).slice(-2),c.innerHTML=("0"+t.seconds).slice(-2),t.total<=0&&clearInterval(i)}r()}(".timer","2021-12-31");const c=document.querySelectorAll("[data-modal]"),i=document.querySelector(".modal"),r=()=>{i.classList.add("show"),i.classList.remove("hide"),document.body.style.overflow="hidden",clearTimeout(u)},l=()=>{i.classList.remove("show"),i.classList.add("hide"),document.body.style.overflow=""},d=()=>{window.pageYOffset+document.documentElement.clientHeight>=document.documentElement.scrollHeight&&(r(),window.removeEventListener("scroll",d))};c.forEach(t=>{t.addEventListener("click",r)}),i.addEventListener("click",t=>{if(t.target===i||""==t.target.getAttribute("data-close")){o&&clearTimeout(o);const t=document.querySelector("[data-thank]");t&&t.remove();const e=document.querySelector(".modal__dialog");e.classList.add("show"),e.classList.remove("hide"),l()}}),document.addEventListener("keydown",t=>{"Escape"===t.code&&i.classList.contains("show")&&l()});const u=setTimeout(r,5e4);window.addEventListener("scroll",d);class m{constructor(t,e,s,n,a,o,...c){this.src=t,this.alt=e,this.subtitle=s,this.descr=n,this.price=a,this.classes=c,this.parent=document.querySelector(o),this.transfer=27,this.changeToUAH()}changeToUAH(){this.price*=this.transfer}render(){const t=document.createElement("div");this.classes.length?this.classes.forEach(e=>t.classList.add(e)):(this.element="menu__item",t.classList.add(this.element)),t.innerHTML=`\n\t\t\t\t\t\t<img src=${this.src} alt=${this.alt}>\n\t\t\t\t\t\t<h3 class="menu__item-subtitle">${this.subtitle}</h3>\n\t\t\t\t\t\t<div class="menu__item-descr">${this.descr}</div>\n\t\t\t\t\t\t<div class="menu__item-divider"></div>\n\t\t\t\t\t\t<div class="menu__item-price">\n\t\t\t\t\t\t\t<div class="menu__item-cost">Цена:</div>\n\t\t\t\t\t\t\t<div class="menu__item-total"><span>${this.price}</span> грн/день</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t `,this.parent.append(t)}}(async t=>{const e=await fetch(t);if(!e.ok)throw new Error(`Could not fetch ${t}, status ${e.status}`);return await e.json()})("http://localhost:3333/menu").then(t=>{t.forEach(({img:t,altimg:e,title:s,descr:n,price:a})=>{new m(t,e,s,n,a,".menu .container").render()})});const h=document.querySelectorAll("form"),g={loading:"img/form/spinner.svg",success:"Спасибо! Скоро мы с вами свяжемся",failure:"Что-то пошло не так....."};h.forEach(t=>{var e;(e=t).addEventListener("submit",t=>{t.preventDefault();const s=document.createElement("img");s.src=g.loading,s.style.cssText="\n\t\t\t\t\t\tdisplay: block;\n\t\t\t\t\t\tmargin: 0 auto;\n\t\t\t\t\t",e.insertAdjacentElement("afterend",s);const n=new FormData(e);(async(t,e)=>{const s=await fetch(t,{method:"POST",headers:{"Content-type":"application/json"},body:e});return await s.json()})("http://localhost:3333/requests",JSON.stringify(Object.fromEntries(n.entries()))).then(t=>{_(g.success),s.remove()}).catch(()=>{_(g.failure)}).finally(()=>{e.reset()})})});function _(t){const e=document.querySelector(".modal__dialog");e.classList.add("hide"),r();const s=document.createElement("div");s.classList.add("modal__dialog"),s.dataset.thank=!0,s.innerHTML=`\n\t\t\t\t<div class="modal__content">\n\t\t\t\t\t<div data-close class="modal__close">&times;</div>\n\t\t\t\t\t<div class="modal__title">${t}</div>\n\t\t\t\t</div>\n\t\t\t\t`,document.querySelector(".modal").append(s),o=setTimeout(()=>{s.remove(),e.classList.add("show"),e.classList.remove("hide"),l()},4e3)}const f=document.querySelector(".offer__slider-wrapper"),v=f.querySelector(".offer__slider-inner"),y=window.getComputedStyle(f).width,p=f.querySelectorAll(".offer__slide"),L=document.querySelector(".offer__slider-prev"),S=document.querySelector(".offer__slider-next"),w=document.querySelector("#total"),E=document.querySelector("#current"),b=[],x=()=>{p.length<10?E.textContent="0"+A:E.textContent=A},q=()=>{b.forEach(t=>{t.classList.remove("_active")}),b[A-1].classList.add("_active")};let A=1,C=0;p.length<10?(w.textContent="0"+p.length,E.textContent="0"+A):(w.textContent=p.length,E.textContent=A),v.style.width=100*p.length+"%",v.style.display="flex",v.style.transition="0.5s all",f.style.overflow="hidden",p.forEach(t=>t.style.width=y);const T=document.createElement("ol");T.classList.add("carousel-indicators"),document.querySelector(".offer__slider").append(T);for(let t=0;t<p.length;t++){const e=document.createElement("li");e.classList.add("dot"),e.setAttribute("data-slides",t),0==t&&e.classList.add("_active"),T.append(e),b.push(e)}function k(t){return+t.replace(/\D/g,"")}S.addEventListener("click",()=>{C==k(y)*(p.length-1)?C=0:C+=k(y),v.style.transform=`translateX(-${C}px`,A==p.length?A=1:A++,x(),q()}),L.addEventListener("click",()=>{0==C?C=k(y)*(p.length-1):C-=k(y),v.style.transform=`translateX(-${C}px`,1==A?A=p.length:A--,x(),q()}),T.addEventListener("click",t=>{if(t.target&&t.target.hasAttribute("data-slides")){const e=+t.target.getAttribute("data-slides");A=e+1,C=e*k(y),v.style.transform=`translateX(-${C}px`,x(),q()}});const M=document.querySelector(".calculating__result span"),$=localStorage.getItem("userParams")?JSON.parse(localStorage.getItem("userParams")):{sex:"female",ratio:"1.375",height:null,weight:null,age:null},D=(t,e)=>{document.querySelectorAll(t+" div").forEach(t=>{t.classList.remove(e),t.getAttribute("data-sex")!==$.sex&&+t.getAttribute("data-ratio")!=+$.ratio||t.classList.add(e)})};D("#gender","calculating__choose-item_active"),D(".calculating__choose_big","calculating__choose-item_active");const H=t=>{for(const e in t)if(!t[e])return void(M.textContent="____");const e=e=>Math.round((e[0]+e[1]*t.weight+e[2]*t.height-e[3]*t.age)*t.ratio);"female"===t.sex&&(M.textContent=e([88.36,13.4,4.8,5.7])),"male"===t.sex&&(M.textContent=e([447.6,9.2,3.1,4.3]))};H($);const O=(t,e)=>{document.querySelector(t).addEventListener("click",s=>{if(s.target.matches(["[data-sex]","[data-ratio]"])){const n=(t,e)=>s.target.hasAttribute(e)?s.target.getAttribute(e):t;$.sex=n($.sex,"data-sex"),$.ratio=+n($.ratio,"data-ratio"),document.querySelectorAll(t+" div").forEach(t=>t.classList.remove(e)),s.target.classList.add(e),localStorage.setItem("userParams",JSON.stringify($)),H($)}})},j=t=>{const e=document.querySelector(t),s=t=>{const e=t.getBoundingClientRect();return{top:e.top,left:e.left}};e.addEventListener("input",()=>{if(e.value.match(/\D/g))e.value=(e.value.match(/\d/g)||[]).join(""),(t=>{if(!t.nextElementSibling||!t.nextElementSibling.classList.contains("input_alert")){const n=document.createElement("div");n.className="input_alert",n.textContent="!Ошибка! Можно вводить только цифры!";const a=s(e),o=s(document.querySelector(".calculating__choose_medium"));n.style.left=a.left-o.left+"px",n.style.top=o.top-a.top-40+"px",t.style.border="2px solid rgb(187, 64, 64)",t.after(n)}})(e);else switch(e.nextElementSibling&&e.nextElementSibling.classList.contains("input_alert")&&(e.nextElementSibling.remove(),e.style.border=""),e.getAttribute("id")){case"height":$.height=+e.value;break;case"weight":$.weight=+e.value;break;case"age":$.age=+e.value}H($)})};O("#gender","calculating__choose-item_active"),O(".calculating__choose_big","calculating__choose-item_active"),j("#height"),j("#weight"),j("#age")});